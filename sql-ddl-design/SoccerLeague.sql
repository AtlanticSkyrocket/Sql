DROP DATABASE IF EXISTS soccer;

CREATE DATABASE soccer;

\c soccer

CREATE TABLE "leagues" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" varchar(255) UNIQUE NOT NULL,
  "season_start_date" timestamp NOT NULL,
  "season_end_date" timestamp NOT NULL
);

CREATE TABLE "teams" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" varchar,
  "league_id" int
);

CREATE TABLE "players" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" varchar(255) UNIQUE NOT NULL,
  "team_id" int
);

CREATE TABLE "referees" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "fullname" varchar(255)
);

CREATE TABLE "matches" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "home_team_id" int NOT NULL,
  "away_team_id" int NOT NULL,
  "referee_id" int NOT NULL,
  "match_date" timestamp
);

CREATE TABLE "goals" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "player_id" int NOT NULL,
  "match_id" int NOT NULL
);

ALTER TABLE "teams" ADD FOREIGN KEY ("league_id") REFERENCES "leagues" ("id");
ALTER TABLE "players" ADD FOREIGN KEY ("team_id") REFERENCES "teams" ("id");
ALTER TABLE "matches" ADD FOREIGN KEY ("home_team_id") REFERENCES "teams" ("id");
ALTER TABLE "matches" ADD FOREIGN KEY ("away_team_id") REFERENCES "teams" ("id");
ALTER TABLE "matches" ADD FOREIGN KEY ("referee_id") REFERENCES "referees" ("id");
ALTER TABLE "goals" ADD FOREIGN KEY ("player_id") REFERENCES "players" ("id");
ALTER TABLE "goals" ADD FOREIGN KEY ("match_id") REFERENCES "matches" ("id");

INSERT INTO leagues(name, season_start_date, season_end_date)
VALUES ('League 1', '2023-08-10', '2024-05-12'),
       ('League 2', '2023-08-13', '2024-05-20');

INSERT INTO teams(name, league_id)
VALUES ('Team 1', 1), ('Team 2', 1), ('Team 3', 1),
       ('Team 4', 2), ('Team 5', 2), ('Team 6', 2);

INSERT INTO players(name, team_id)
VALUES ('Player 1', 1), ('Player 2', 1), ('Player 3', 1),
       ('Player 4', 2), ('Player 5', 2), ('Player 6', 2),
       ('Player 7', 3), ('Player 8', 3), ('Player 9', 3),
       ('Player 10', 4), ('Player 11', 4), ('Player 12', 4),
       ('Player 13', 5), ('Player 14', 5), ('Player 15', 5),
       ('Player 16', 6), ('Player 17', 6), ('Player 18', 6);

INSERT INTO referees(fullname)
VALUES ('Referee 1'), ('Referee 2'), ('Referee 3'), 
       ('Referee 4'), ('Referee 5'), ('Referee 6');

INSERT INTO matches(home_team_id, away_team_id, referee_id, match_date)
VALUES (1, 2, 1, '2023-08-14'),
       (3, 4, 2, '2023-08-21'),
       (5, 6, 3, '2023-08-28'),
       (2, 1, 4, '2023-09-04'),
       (4, 3, 5, '2023-09-11'),
       (6, 5, 6, '2023-09-18');

INSERT INTO goals(player_id, match_id)
VALUES 
  (1, 1), (2, 1),
  (7, 2), (8, 2), (10, 2), (11, 2),
  (13, 3), (14, 3),
  (4, 4),
  (10, 5), (11, 5), (12, 5),
  (16, 6);

